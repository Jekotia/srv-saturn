#! /bin/bash
cd "`dirname $1`"

DIR="`pwd`"
echo "DIR=$DIR"

Dockerfile="`basename $1`"
echo "Dockerfile=$Dockerfile"

##arch="`basename $DIR`"
##echo `dirname $Dockerfile`
arch="$(echo "$Dockerfile" | cut -d'.' -f2)"
echo "arch=$arch"

##image="`dirname $DIR`"
image="`basename $DIR`"
echo "image=$image"

if [[ "$arch" == "Dockerfile" ]] ; then
	imageName=${image}
else
	imageName=${image}_${arch}
fi
echo "imageName=$imageName"

echo "Building 'jekotia/${imageName}' from '$DIR'"
if docker build -t jekotia/$imageName -f $Dockerfile `pwd` $2 ; then
	status="0"
else
	status="1"
fi
echo "Finished building 'jekotia/${imageName}' from '$DIR'"

exit $status
