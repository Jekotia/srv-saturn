#! /bin/bash
cd "`dirname $1`"

DIR="`pwd`"
echo "DIR=$DIR"

Dockerfile="`basename $1`"
echo "Dockerfile=$Dockerfile"

##arch="`basename $DIR`"
##echo `dirname $Dockerfile`
arch="$(echo "$Dockerfile" | cut -d'.' -f2)"
echo "arch=$arch"

##image="`dirname $DIR`"
image="`basename $DIR`"
echo "image=$image"

echo "Building 'jekotia/${image}_${arch}' from '$DIR'"
if docker build -t jekotia/${image}_${arch} -f $Dockerfile `pwd` $2 ; then
	status="0"
else
	status="1"
fi
echo "Finished building 'jekotia/${image}_${arch}' from '$DIR'"

exit $status
